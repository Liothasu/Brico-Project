{% extends 'base.html.twig' %}

{% set blog = entity %}

{% block title %}
	{{ blog.title }}
{% endblock %}

{% block main %}
	<section class="container">
		<a href="{{ path('blog_list') }}" class="btn btn-danger">Back to the blogs</a>
		<div class="row">
			<div class="col">
				<h2 class="blog-title">{{ blog.title }}</h2>
				<img src="{{ asset('uploads/' ~ entity.featuredMedia.filename) }}" alt="{{ entity.featuredMedia.altText ?? 'Featured Image' }}" width="350" height="205">
			</div>
		</div>
		{% if blog.author == app.user %}
			<a href="{{ path('blog_edit', {'id': blog.id}) }}" class="btn btn-primary mt-4">Edit Blog</a>
		{% endif %}
		<hr>
		<div class="row">
			<div class="col">
				<div id="blog-content" class="blog-content">
					<p>
						{{ blog.content|striptags }}
					</p>
				</div>
			</div>
		</div>
		{% if is_granted('IS_AUTHENTICATED_FULLY') %}
			<div>
				{{ form(commentForm, { attr: { class: 'comment-form' } }) }}
					<hr>
				</div>

				<h2 class="comments-title mt-5">
					<span id="comment-count">{{ blog.comments|length }}</span>
					comment(s)
				</h2>
				<div class="comment-list mt-5" id="comments">
					<div class="d-flex justify-content-center">
						<div class="spinner-border" role="status">
							<span class="visually-hidden">Loading...</span>
						</div>
					</div>
				</div>
				<div class="blog-data d-none" data-content="{{ blog.content|json_encode }}" data-id="{{ blog.id }}" data-is-author="{{ app.user == blog.author and not preview }}" data-user-id="{{ app.user.id }}"></div>
			{% else %}
				<div>
					<p>Log in to see comments.</p>
					<a href="{{ path('login') }}" class="btn btn-primary">Log in</a>
				</div>
			{% endif %}
		</section>
	{% endblock %}

	{% block javascripts %}
		{{ parent() }}
		{{ encore_entry_script_tags('blog') }}
		{{ encore_entry_script_tags('comment') }}
	{% endblock %}
